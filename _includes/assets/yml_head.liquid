{%- assign in_reply_to_link = page.in_reply_to.link | default: page.in_reply_to -%}
{%- assign in_reply_to_title = page.in_reply_to.title -%}
{%- assign bookmark_of_link = page.bookmark_of.link | default: page.bookmark_of -%}
{%- assign bookmark_of_title = page.bookmark_of.title -%}
{%- assign like_of_link = page.like_of.link | default: page.like_of -%}
{%- assign like_of_title = page.like_of.title -%}
{%- assign listen_of_link = page.listen_of.link | default: page.listen_of -%}
{%- unless listen_of_link contains '://' or listen_of_link == null -%}
    {%- assign listen_of_link = 'https://song.link/album/s/' | append: listen_of_link -%}
{%- endunless -%}
{%- assign listen_of_title = page.listen_of.title -%}
{%- assign read_of_link = page.read_of.link | default: page.read_of -%}
{%- assign read_of_title = page.read_of.title -%}
{%- assign played_of_link = page.played_of.link | default: page.played_of.chess | default: page.played_of.lichess | default: page.played_of -%}
{%- assign played_of_title = page.played_of.title -%}
{%- assign watch_of_link = page.watch_of.link | default: page.watch_of -%}
{%- assign watch_of_title = page.watch_of.title -%}
{%- assign link = bookmark_of_link | default: like_of_link | default: listen_of_link | default: played_of_link | default: read_of_link | default: watch_of_link | default: page.link | default: null -%}
{%- assign link_title = bookmark_of_title | default: like_of_title | default: listen_of_title | default: played_of_title | default: read_of_title | default: watch_of_title | default: page.link.title | default: null -%}
{%- assign link_author_name = page.bookmark_of.authors[0].name | default: null -%}
{%- assign link_author_url = page.bookmark_of.authors[0].url | default: null -%}
{%- unless link_title -%}
    {%- assign link_title = link | remove: 'http://' | remove: 'https://' | remove: 'www.' -%}
{%- endunless -%}
{%- assign syndicate_to = null -%}
{%- if page.category == 'beer' -%}
    {%- assign link_title = page.title -%}
    {%- if link contains 'untappd.com' -%}
        {%- assign link_title = link_title | append: ' on Untappd' -%}
    {%- endif -%}
    {%- assign untappd_link = site.author.urls.untappd | append: '/checkin/' | append: page.slug -%}
    {%- assign syndicate_to = site.emptyArray | push: untappd_link -%}
{%- elsif page.category == 'book' -%}
    {%- assign link_title = page.title -%}
    {%- if link contains 'abookapart.com' -%}
        {%- assign link_title = link_title | append: ' on A Book Apart' -%}
    {%- elsif link contains 'goodreads.com' -%}
        {%- assign link_title = link_title | append: ' on Goodreads' -%}
    {%- endif -%}
{%- elsif page.category == 'chess' -%}
    {%- if link contains 'chess.com' -%}
        {%- assign link_title = 'View this game on Chess.com' -%}
    {%- elsif link contains 'lichess.org' -%}
        {%- assign link_title = 'View this game on lichess.org' -%}
    {%- endif -%}
{%- elsif page.category == 'music' -%}
    {%- assign link_title = page.title -%}
    {%- if link contains 'bandcamp.com' -%}
        {%- assign link_title = link_title | append: ' on Bandcamp' -%}
    {%- elsif link contains 'soundcloud.com' -%}
        {%- assign link_title = link_title | append: ' on SoundCloud' -%}
    {%- elsif link contains 'spotify.com' -%}
        {%- assign link_title = link_title | append: ' on Spotify' -%}
    {%- elsif link contains 'youtube.com' -%}
        {%- assign link_title = link_title | append: ' on YouTube' -%}
    {%- elsif link contains 'song.link' -%}
        {%- assign link_title = link_title | append: ' on Songlink' -%}
    {%- endif -%}
{%- endif -%}

{% if page.category == 'like' %}
    {% capture meta_title %}Liked: {{ link_title }} – {{ site.title }}{% endcapture %}
{% elsif page.titlefree %}
    {% capture meta_title %}{{ page.date | date: '%A, %d %B %Y' }} – {{ site.title }}{% endcapture %}
{% elsif page.title %}
    {% capture meta_title %}{{ page.title | strip_html }} – {{ site.title }}{% endcapture %}
{% else %}
    {% capture meta_title %}{{ site.title }} – {{ site.tagline | strip_html }}{% endcapture %}
{% endif %}

{% if page.lede %}
    {% assign meta_lede = page.lede | strip_html %}
{% elsif page.category == 'beer' %}
    {% capture meta_lede %}One of my beer reviews, {{ page.title | strip_html }}.{% endcapture %}
{% elsif page.category == 'bookmark' %}
    {% capture meta_lede %}One of my shared bookmarks, {{ page.title | strip_html }}.{% endcapture %}
{% elsif page.category == 'book' %}
    {% capture meta_lede %}One of my book reviews, {{ page.title | strip_html }}.{% endcapture %}
{% elsif page.category == 'chess' %}
    {% capture meta_lede %}One of my chess games from {{ page.date | date: '%A, %d %B %Y' }}.{% endcapture %}
{% elsif page.category == 'like' %}
    {% capture meta_lede %}One of my liked pages, {{ link_title | strip_html }}.{% endcapture %}
{% elsif page.category == 'movie' %}
    {% capture meta_lede %}One of my movie check-ins, {{ page.title | strip_html }}.{% endcapture %}
{% elsif page.category == 'music' %}
    {% capture meta_lede %}One of my music album reviews, {{ page.title | strip_html }}.{% endcapture %}
{% elsif page.category == 'note' %}
    {% capture meta_lede %}{{ page.content | markdownify | strip_html | strip_newlines | normalize_whitespace | xml_escape | replace: '\', '' | truncatewords: 20 }}{% endcapture %}
{% elsif page.category == 'pen' %}
    {% capture meta_lede %}One of my CodePens, {{ page.title | strip_html }}.{% endcapture %}
{% elsif page.category == 'podcast' %}
    {% capture meta_lede %}One of my podcast check-ins, {{ page.title | strip_html }}.{% endcapture %}
{% elsif page.category == 'recipe' %}
    {% capture meta_lede %}One of my recipes, {{ page.title | strip_html }}.{% endcapture %}
{% elsif page.category == 'talk' %}
    {% capture meta_lede %}One of my talks, {{ page.title | strip_html }}{% if page.checkin %}, given at {{ page.checkin.name | default: page.checkin }}{% endif %},{% endcapture %}
{% elsif page.category == 'tv' %}
    {% capture meta_lede %}One of my TV check-ins, {{ page.title | strip_html }}.{% endcapture %}
{% else %}
    {% assign meta_lede = site.lede | strip_html %}
{% endif %}

{% assign meta_image = site.author.avatar | absolute_url %}
{% if page.banner %}
    {% assign meta_image = page.banner | last | prepend: '/images/banners/' | absolute_url %}
{% elsif page.banner_mobile %}
    {% assign meta_image = page.banner_mobile | last | prepend: '/images/banners/' | absolute_url %}
{% elsif page.cover contains '://' %}
    {% assign meta_image = page.cover %}
{% elsif page.cover %}
    {% assign meta_image = page.cover | prepend: '/' | prepend: page.category | prepend: '/static/' | absolute_url %}
{% elsif page.page_class contains 'about' %}
    {% assign meta_image = '/images/content/rachel-and-i.jpg' | absolute_url %}
{% endif %}

{% capture body_class %}
    {% for class in page.page_class %}
        {{ class }}
    {% endfor %}
    {% if page.category %}
        page--{{ page.category }}
    {% endif %}
    {% if page.collection and page.collection != 'posts' %}
        page--{{ page.collection }}
    {% endif %}
    {% if site.color_scheme %}
        {{ site.color_scheme | downcase }}
    {% endif %}
{% endcapture %}
{% assign body_class_array = body_class | split: ' ' | join: '  ' %}

{% assign meta_name = site.author.name | split: ' ' %}
{% assign meta_first_name = meta_name[0] %}
{% assign meta_last_name = meta_name[1] %}
