{%- comment -%}

  Consolidate markup for Content List Items.

{%- endcomment -%}
{%- assign link = page.bookmark_of.link | default: page.bookmark_of | default: page.like_of.link | default: page.like_of | default: page.link.url | default: page.link | default: null -%}
{%- assign category_link = site.data.categories | where: 'category', page.category | first | map: 'type' -%}
{%- assign date_human = page.date | date_to_long_string -%}
{%- if include.relative_year == true -%}
    {%- assign year_today = site.time | date: '%Y' -%}
    {%- assign year_then = page.date | date: '%Y' -%}
    {%- assign date_human = year_today | minus: year_then | append: ' years ago' -%}
{%- endif -%}
<li role="listitem">
    <article class="h-entry" role="article">
        <a class="u-url" href="{{ page.url }}">
            {% if page.category == 'article' or page.category == 'recipe' %}
                {% include_cached content/svg.html type='article' %}
            {% elsif page.category == 'bookmark' %}
                {% include_cached content/svg.html type='link' %}
            {% elsif page.category == 'note' %}
                {% include_cached content/svg.html type='feather' %}
            {% elsif page.category == 'pen' %}
                {% include_cached content/svg.html type='codepen' %}
            {% else %}
                {% include_cached content/svg.html type='bullhorn' %}
            {% endif %}
            <h3 class="delta  title{% unless page.category == 'note' %}  p-name{% endunless %}"{% if page.category == 'note' %} hidden{% endif %}>
                {% if page.category == 'note' %}
                    {{ page.date | date: '%A, %d %B %Y' }}
                {% else %}
                    {{ page.title | strip_html }}
                {% endif %}
            </h3>
            <div class="lede">
                {% if page.in_reply_to.first %}
                    {%- assign reply_targets_map = site.data.reply_targets | where_exp: 'target', 'page.in_reply_to.first contains target.contains' | first | map: 'name' | default: null -%}
                    <span class="emoji">↩️</span> In reply to:
                    {% if reply_targets_map %}
                        <data class="h-cite  u-in-reply-to" value="{{ page.in_reply_to.first }}">{{ reply_targets_map }}</data>
                    {% elsif page.in_reply_to.first contains 'mastodon.social' %}
                        <data class="h-cite  u-in-reply-to" value="{{ page.in_reply_to.first }}">a Toot</data>
                    {% elsif page.in_reply_to.first contains 'twitter.com' %}
                        {% if page.in_reply_to.first contains '/status/' %}
                            <data class="h-cite  u-in-reply-to" value="{{ page.in_reply_to.first }}">@{{ page.in_reply_to.first | split: '/status/' | first | split: 'twitter.com/' | last }}</data>
                        {% else %}
                            <data class="h-cite  u-in-reply-to" value="{{ page.in_reply_to.first }}">a Tweet</data>
                        {% endif %}
                    {% else %}
                        <data class="h-cite  u-in-reply-to" value="{{ page.in_reply_to.first }}">{{ page.in_reply_to.first }}</data>
                    {% endif %}
                    <br>
                {% endif %}
                {% if page.checkin %}
                    <span class="emoji">🗺</span>
                    <span class="p-location">{{ page.checkin.name | default: page.checkin }}</span>
                    <br>
                {% endif %}
                {% if page.emoji %}
                    <span class="emoji">{{ page.emoji }}</span>
                {% endif %}
                {% if page.rsvp %}
                    <span class="emoji">📅</span>
                {% endif %}
                {% if page.banner or page.banner_mobile or page.mf_photo or page.cover or page.content contains '<img' %}
                    {% unless page.mf_root == 'review' %}
                        <span class="emoji">🖼️</span>
                    {% endunless %}
                {% endif %}
                {% if page.reacji %}
                    <span class="emoji  p-summary  e-content">{{ page.reacji }}</span>
                {% elsif page.lede %}
                    <span class="p-summary">{{ page.lede | strip_html | truncatewords: 20 | replace: ',...', '...' | replace: '....', '...' | strip }}</span>
                    <span class="e-content" aria-hidden="true" hidden>{{ page.lede | strip_html | strip }}</span>
                {% elsif page.category == 'music' %}
                    <span class="p-summary  e-content">Album <span>Review</span></span>
                {% elsif page.category == 'note' %}
                    {%- assign content = page.content | markdownify | strip_html | replace: '&lt;figcaption&gt;', '' | replace: '&lt;/figcaption&gt;', '' | replace: '&lt;p&gt;', '' | replace: '&lt;/p&gt;', '' | strip -%}
                    <span class="p-summary">{{ content | truncatewords: 30 | replace: ',...', '...' | replace: '....', '...' | strip }}</span>
                    <span class="e-content" aria-hidden="true" hidden>{{ content }}</span>
                {% else %}
                    <span class="p-summary  e-content">{% include content/capitalizer.html input=page.category %}{% if page.layout == 'review' %} <span>Review</span>{% endif %}</span>
                {% endif %}
                {% if page.layout == 'review' and page.authors %}
                    by
                    {%- assign authors = page.authors | uniq -%}
                    {%- for author in authors -%}
                        {% unless forloop.first %}, {% endunless %}
                        <span class="h-cite">{{ author.name | default: author | strip }}</span>
                    {%- endfor -%}
                {% endif %}
                {% if page.badges %}
                    <data class="badges" value="{{ page.badges.size }}"><span class="emoji">🏅</span> Earned {{ page.badges.size }} badge{% if page.badges.size > 1 %}s{% endif %}.</data>
                {% endif %}
                {% if page.rating %}
                    {%- assign rating_base = page.rating | default: 0 | at_least: 0 | at_most: 5 | floor -%}
                    {%- assign rating_fraction = page.rating | minus: rating_base -%}
                    <data class="p-worst" hidden>0</data>
                    <data class="p-best" hidden>5</data>
                    <data class="p-rating  rating  delta" value="{{ page.rating }}">{% for count in (1..rating_base) %}★{% endfor %}{% if rating_fraction == 0.25 %}¼{% elsif rating_fraction == 0.5 %}½{% elsif rating_fraction == 0.75 %}¾{% endif %}</data>
                {% endif %}
            </div>
            <time class="date  dt-published" datetime="{{ page.date | date_to_xmlschema }}">{{ date_human }}</time>
        </a>
        {% if page.mf_property %}
            <data class="u-{{ page.mf_property }}" hidden>{{ link }}</data>
        {% endif %}
        <data class="u-category" value="/{{ category_link }}/" hidden>{{ page.category }}</data>
        <a class="u-author" href="/" aria-hidden="true" hidden tabindex="-1"></a>
    </article>
</li>
