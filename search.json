---
layout: null
searchable: false
sitemap:
  exclude: true
---

{
  "results": [
    {%- assign pages = site.pages | concat: site.webpages -%}
    {% for page in pages %}
      {% unless page.draft or page.title == null or page.title == empty or page.searchable == false %}
        {
          "type": "page",
          "url": "{{ page.url | absolute_url }}",
          "title": "{{ page.title | xml_escape }}",
          "priority": "{{ page.sitemap.priority | default: site.sitemap.priority }}",
          "lede": "{{ page.lede | strip_html | xml_escape | strip_newlines | normalize_whitespace }}"{% unless page.searchable == 'no-content' %},
            "content": "{{ page.content | strip_html | xml_escape | strip_newlines | normalize_whitespace }}"
          {% endunless %}
        },
      {% endunless %}
    {% endfor %}
    {% for page in site.posts %}
      {% unless page.draft or page.searchable == false %}
        {%- assign bookmark_of_link = page.bookmark_of.link | default: page.bookmark_of -%}
        {%- assign like_of_link = page.like_of.link | default: page.like_of -%}
        {%- assign listen_of_link = page.listen_of.link | default: page.listen_of -%}
        {%- unless listen_of_link contains '://' or listen_of_link == null -%}
          {%- assign listen_of_link = 'https://song.link/album/s/' | append: listen_of_link -%}
        {%- endunless -%}
        {%- assign play_of_link = page.play_of.link | default: page.play_of -%}
        {%- assign read_of_link = page.read_of.link | default: page.read_of -%}
        {%- assign watch_of_link = page.watch_of.link | default: page.watch_of -%}
        {%- assign link = bookmark_of_link | default: like_of_link | default: listen_of_link | default: play_of_link | default: read_of_link | default: watch_of_link | default: page.link -%}
        {
          "type": "post",
          "url": "{{ page.url | absolute_url }}",{% if link %}
          "link": "{{ link }}",{% endif %}
          "title": "{{ page.title | xml_escape }}",
          "priority": "{{ page.sitemap.priority | default: site.sitemap.priority }}",
          "date": "{{ page.date | date_to_xml_schema }}",
          "date_friendly": "{{ page.date | date_to_long_string }}",
          {% if page.lede %}
            "lede": "{{ page.lede | replace: "'", "â€™" | strip_html | xml_escape | strip_newlines | normalize_whitespace }}",
          {% elsif page.category == 'note' %}
            "lede": "{{ page.content | markdownify | strip_html | xml_escape | strip_newlines | normalize_whitespace }}",
          {% endif %}
          "category": "{{ page.category }}"{% if page.codepen_featured %},
            "codepen_featured": true
          {% endif %}{% if page.emoji %},
            "emoji": "{{ page.emoji }}"
          {% endif %},
          "tags": "{{ page.tags | join: ', ' }}"{% if page.checkin %},
            "checkin": "{{ page.checkin.name | default: page.checkin | strip_html | xml_escape | strip_newlines | normalize_whitespace | xml_escape }}"
          {% endif %}{% if page.rating and page.rating != 'Parti Pris' %},
            "rating": "{{ page.rating }}"
          {% endif %}{% if page.authors %},
            "authors": "{% for author in page.authors %}{%- assign author_name = author.name | default: author | strip -%}{%- assign author_map = site.data.people | where_exp: 'target', 'author_name == target.name' | first | default: null -%}{% unless forloop.first %}, {% endunless %}{{ author_name | xml_escape }}{% endfor %}"
          {% endif %}{% if page.in_reply_to %},
            "in_reply_to": "{{ page.in_reply_to.link | default: page.in_reply_to }}"
          {% endif %}{% if page.rsvp %},
            "rsvp": true
          {% endif %}{% if page.badges %},
            "badges": {{ page.badges.size }}
          {% endif %}{% if page.banner %},
            "banner": true
          {% endif %}{% if page.cover %},
            "cover": true
          {% endif %}{% if page.content contains '<img' %},
            "has_image": true
          {% endif %}{% if page.titlefree %},
            "titlefree": true
          {% endif %}{% unless page.searchable == 'no-content' %},
            "content": "{{ page.content | strip_html | xml_escape | strip_newlines | normalize_whitespace | replace: '\', '' }}"
          {% endunless %}
        }{% unless forloop.last %},{% endunless %}
      {% endunless %}
    {% endfor %}
  ],
  "people": [
    {% for target in site.data.people %}
      {
        "name": "{{ target.name }}"{% if target.mastodon %},
        "mastodon": ["{{ target.mastodon | join: '", "' }}"]{% endif %}{% if target.twitter %},
        "twitter": ["{{ target.twitter | join: '", "' }}"]{% endif %}{% if target.link %},
        "link": ["{{ target.link | join: '", "' }}"]{% endif %}
      }{% unless forloop.last %},{% endunless %}
    {% endfor %}
  ],
  "mastodon-instances": [
    {{ site.data.mastodon_instances | join: '","' | prepend: '"' | append: '"' }}
  ]
}
